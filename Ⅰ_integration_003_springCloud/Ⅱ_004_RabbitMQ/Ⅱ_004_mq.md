# 一、安装RabbitMQ
<br/>

## 1. 软件安装
```linux
docker pull rabbitmq:3.8-management
```
## 2.创建mq容器
```linux
docker run \
 -e RABBITMQ_DEFAULT_USER=root \
 -e RABBITMQ_DEFAULT_PASS=root \
 -v mq-plugins:/plugins \
 --name mq \
 --hostname mq \
 -p 15672:15672 \
 -p 5672:5672 \
 -d \
 rabbitmq:3.8-management
```
访问控制台: [http://139.224.230.186:15672/#/](http://139.224.230.186:15672/#/ "http://139.224.230.186:15672/#/")

</br>

# 二、workQueue
<br/>

## 1.依赖(父工程)
```xml
<!--AMQP依赖，包含RabbitMQ-->
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

## 2.publisher
*<u>application.yml配置类</u>*
```yml
logging:
  pattern:
    dateformat: MM-dd HH:mm:ss:SSS
spring:
  rabbitmq:
    host: 139.224.230.186 # 主机名
    port: 5672 # 端口
    virtual-host: / # 虚拟主机
    username: root # 用户名
    password: root # 密码
```

*<u>测试类</u>*
```java
@Autowired  
private RabbitTemplate rabbitTemplate;

/**
 * workQueue
 * 向队列中不停发送消息，模拟消息堆积。
 */
@Test
public void testWorkQueue() throws InterruptedException {
	// 队列名称
	String queueName = "simple.queue";
	// 消息
	String message = "hello, message_";
	for (int i = 1; i <= 50; i++) {
		// 发送消息
		rabbitTemplate.convertAndSend(queueName, message + i);
		Thread.sleep(20);
	}
}
```

## 3.consumer
*<u>模拟两个消费者接收</u>*
```java
@RabbitListener(queues = "simple.queue")
public void listenSimpleQueue1(String msg) throws InterruptedException {
	System.out.println("消费者1接收到消息 -> " +msg);
	Thread.sleep(20);
}

@RabbitListener(queues = "simple.queue")
public void listenSimpleQueue2(String msg) throws InterruptedException {
	System.err.println("消费者2接收到消息 -> " +msg);
	Thread.sleep(200);
}
```

</br>

# 三、FanoutExchange
<br/>

## 1.publisher
```java
/**  
 * fanoutExchange */@Test  
public void testFanoutExchange() {  
	// 队列名称  
	String exchangeName = "itcast.fanout";  
	// 消息  
	String message = "hello, everyone!";  
	rabbitTemplate.convertAndSend(exchangeName, "", message);  
}
```

## 2.FanoutConfig类
```java
import org.springframework.amqp.core.Binding;  
import org.springframework.amqp.core.BindingBuilder;  
import org.springframework.amqp.core.FanoutExchange;  
import org.springframework.amqp.core.Queue;  
import org.springframework.context.annotation.Bean;  
import org.springframework.context.annotation.Configuration;  
  
/**  
 * @author SaddyFire  
 * @date 2021/12/18  
 * @TIME:14:47  
 */  
@Configuration  
public class FanoutConfig {  
 /**  
 * 声明交换机  
 * @return Fanout类型交换机  
 */  
 @Bean  
 public FanoutExchange fanoutExchange(){  
	 return new FanoutExchange("itcast.fanout");  
 }  
  
 /**  
 * 第1个队列  
 */  
 @Bean  
 public Queue fanoutQueue1(){  
	 return new Queue("fanout.queue1");  
 }  
  
 /**  
 * 绑定队列和交换机  
 */  
 @Bean  
 public Binding bindingQueue1(Queue fanoutQueue1, FanoutExchange fanoutExchange){  
	 return BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);  
 }  
  
 /**  
 * 第2个队列  
 */  
 @Bean  
 public Queue fanoutQueue2(){  
	 return new Queue("fanout.queue2");  
 }  
  
/**  
* 绑定队列和交换机  
*/  
@Bean  
public Binding bindingQueue2(Queue fanoutQueue2, FanoutExchange fanoutExchange){  
		return BindingBuilder
		.bind(fanoutQueue2)
		.to(fanoutExchange);  
}  
  

```

## 3.consumer

```java
@RabbitListener(queues = "fanout.queue1")  
public void listenFanoutQueue1(String msg) {  
	 System.out.println("消费者1接收到Fanout消息：【" + msg + "】");  
}  
  
@RabbitListener(queues = "fanout.queue2")  
public void listenFanoutQueue2(String msg) {  
	 System.out.println("消费者2接收到Fanout消息：【" + msg + "】");  
}
```

</br>

# 四、directExchange
<br/>

## 1.publisher
```java
/**  
 * directExchange */@Test  
public void testDirectExchange() {  
	// 交换机名称  
	String exchangeName = "itcast.direct";  
	// 消息  
	String message = "hello, red!";  
	String message2 = "hello, blue!";  
	String message3 = "hello, yellow!";  

	// 发送消息  
	for (int i = 1; i <= 3; i++) {  
		rabbitTemplate.convertAndSend(exchangeName, "red", message);  
		rabbitTemplate.convertAndSend(exchangeName, "blue", message2);  
		rabbitTemplate.convertAndSend(exchangeName, "yellow", message3);  
	}  
}
```

## 2.consumer
*<u>注意注解</u>*
```java
/**  
 * directExchange * @param msg  
 */  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "direct.queue1"), //定义队列名  
 exchange = @Exchange(name = "itcast.direct"), //定义交换机名字/类型(可省略)  
 key = {"blue","yellow"} //定义derict  
))  
public void listenDirectQueue1(String msg){  
	 System.out.println("direct.queue1收到消息__" +msg);  
}  
  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "direct.queue2"), //定义队列名  
 exchange = @Exchange(name = "itcast.direct"), //定义交换机名字/类型(可省略)  
 key = {"red","yellow"} //定义derict  
))  
public void listenDirectQueue2(String msg){  
	 System.err.println("direct.queue2收到消息__" +msg);  
}
```

</br>

# 五、topicExchange
<br/>

## 1.publisher

```java
/**  
 * topicExchange 
 */
@Test  
public void testTopicExchange() {  
	 // 交换机名称  
	 String exchangeName = "itcast.topic";  
	 // 消息  
	 String message = "中国yyds!";  
	 String message2 = "小日本👇!";  
	 String message3 = "明天是个好天气!";  

	 // 发送消息  
	 for (int i = 1; i <= 3; i++) {  
		 rabbitTemplate.convertAndSend(exchangeName, "china.new", message);  
		 rabbitTemplate.convertAndSend(exchangeName, "japan.new", message2);  
		 rabbitTemplate.convertAndSend(exchangeName, "china.day", message3);  
	 }  
}
```

## 2.consumer
```java
/**  
 * topicExchange * @param msg  
 */  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "topic.queue1"), //定义队列名  
 exchange = @Exchange(name = "itcast.topic",type = ExchangeTypes.TOPIC), //定义交换机名字/类型(可省略)  
 key = "china.#" //定义derict  
))  
public void listenTopicQueue1(String msg){  
 System.err.println("topic.queue1收到消息__" +msg);  
}  
  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "topic.queue2"), //定义队列名  
 exchange = @Exchange(name = "itcast.topic",type = ExchangeTypes.TOPIC), //定义交换机名字/类型(可省略)  
 key = "#.new" //定义derict  
))  
public void listenTopicQueue2(String msg){  
 System.err.println("topic.queue2收到消息__" +msg);  
}
```

</br>

# 六、对象的传输
<br/>

## publish
```java
/**  
 * fastJson转换对象  
 */  
/**  
 * workQueue * 向队列中不停发送消息，模拟消息堆积。  
 */  
@Test  
public void testWorkQueueJson(){  
	// 队列名称  
	String queueName = "simple.queue.json";  
	// 消息  
	Map<String, Integer> map = new HashMap<>();  
	map.put("deedee",88);  
	String jsonMap = JSON.toJSONString(map);  
	rabbitTemplate.convertAndSend(queueName,jsonMap);  
}
```

## consumer
```java
@RabbitListener(queues = "simple.queue.json")  
public void queueJson(String msg){  
	 Map map = JSON.parseObject(msg, Map.class);  
	 System.out.println(map);  
}
```














