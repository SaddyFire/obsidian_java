## 1. 达梦数据库连接jdbc
##### 01 本地mvn依赖导入仓库











## 2. 数据库密码加密处理
##### 01 原生jasypt

1. 依赖(版本不能太高)
```xml
<!--用于数据库加密-->
<dependency>
	<groupId>com.github.ulisesbocchio</groupId>
	<artifactId>jasypt-spring-boot-starter</artifactId>
	<version>2.1.2</version>
</dependency>
```
2. 测试类(求出加密后的密文)
```java
package com.consmation.demo.test;

import com.consmation.demo.InterfaceApplication;
import org.jasypt.encryption.pbe.StandardPBEStringEncryptor;
import org.jasypt.encryption.pbe.config.EnvironmentPBEConfig;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

/**
 * @author SaddyFire
 * @date 2022/3/29
 * @TIME:11:29
 */
@RunWith(SpringRunner.class)
@SpringBootTest(classes = InterfaceApplication.class)
public class JasypTest {

    @Test
    public void testEncrypt() throws Exception {
        StandardPBEStringEncryptor standardPBEStringEncryptor = new StandardPBEStringEncryptor();
        EnvironmentPBEConfig config = new EnvironmentPBEConfig();

        config.setAlgorithm("PBEWithMD5AndDES");          // 加密的算法，这个算法是默认的
        config.setPassword("interface");                        // 加密的密钥
        standardPBEStringEncryptor.setConfig(config);
        String plainText = "2323";  //w8IoQjdyZt5sfw/LHEresw==
        String encryptedText = standardPBEStringEncryptor.encrypt(plainText);
        System.out.println(encryptedText);
    }

    @Test
    public void testDe() throws Exception {
        StandardPBEStringEncryptor standardPBEStringEncryptor = new StandardPBEStringEncryptor();
        EnvironmentPBEConfig config = new EnvironmentPBEConfig();

        config.setAlgorithm("PBEWithMD5AndDES");
        config.setPassword("interface");
        standardPBEStringEncryptor.setConfig(config);
        String encryptedText = "FTvZOgbWC6d7PFrIfoVqzg==";
        String plainText = standardPBEStringEncryptor.decrypt(encryptedText);
        System.out.println(plainText);
    }
    
}
```
3. application.yml配置
```yml
spring
  datasource
    druid:
      driver-class-name: com.mysql.cj.jdbc.Driver
      url: jdbc:mysql://localhost:3306/interface0?serverTimezone=Asia/Shanghai&useUnicode=true&characterEncoding=utf-8&zeroDateTimeBehavior=convertToNull&useSSL=false&allowPublicKeyRetrieval=true
      username: root
      password: ENC(w8IoQjdyZt5sfw/LHEresw==)
# jasypt加密的盐值
jasypt:
  encryptor:
    password: interface
```

##### 02密钥安全性优化
将密钥添加至VM options
`-Djasypt.encryptor.password="interface"`
![[Pasted image 20220329122209.png]]


**生产环境**
`java -Djasypt.encryptor.password=interface -jar xxx.jar`

```text
# 配置profile文件
export JASYPT_PASSWORD = pkslow

# 生效
source /etc/profile

# 运行java程序时
java -jar -Djasypt.encryptor.password=${JASYPT_PASSWORD} xxx.jar
```


##### 03 注入StringEncryptorHandler方式(将jasypt.encryptor.password隐藏)

`package com.consmation.demo.config;`
```java
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
/**
 * @author SaddyFire
 * @date 2022/3/24
 * @TIME:18:26
 * 处理器配置类
 */

@Configuration
public class MyBatisPlusConfig {

    @Bean
    public MybatisPlusInterceptor getMPI(){
        //创建拦截器容器
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        //向容器增加分页拦截器
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor());
        return interceptor;
    }
}

```

