# ä¸€ã€å®‰è£…RabbitMQ
<br/>

## 1. è½¯ä»¶å®‰è£…
```linux
docker pull rabbitmq:3.8-management
```
## 2.åˆ›å»ºmqå®¹å™¨
```linux
docker run \
 -e RABBITMQ_DEFAULT_USER=root \
 -e RABBITMQ_DEFAULT_PASS=root \
 -v mq-plugins:/plugins \
 --name mq \
 --hostname mq \
 -p 15672:15672 \
 -p 5672:5672 \
 -d \
 rabbitmq:3.8-management
```
è®¿é—®æ§åˆ¶å°: [http://139.224.230.186:15672/#/](http://139.224.230.186:15672/#/ "http://139.224.230.186:15672/#/")

</br>

# äºŒã€workQueue
<br/>

## 1.ä¾èµ–(çˆ¶å·¥ç¨‹)
```xml
<!--AMQPä¾èµ–ï¼ŒåŒ…å«RabbitMQ-->
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

## 2.publisher
*<u>application.ymlé…ç½®ç±»</u>*
```yml
logging:
  pattern:
    dateformat: MM-dd HH:mm:ss:SSS
spring:
  rabbitmq:
    host: 139.224.230.186 # ä¸»æœºå
    port: 5672 # ç«¯å£
    virtual-host: / # è™šæ‹Ÿä¸»æœº
    username: root # ç”¨æˆ·å
    password: root # å¯†ç 
```

*<u>æµ‹è¯•ç±»</u>*
```java
@Autowired  
private RabbitTemplate rabbitTemplate;

/**
 * workQueue
 * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚
 */
@Test
public void testWorkQueue() throws InterruptedException {
	// é˜Ÿåˆ—åç§°
	String queueName = "simple.queue";
	// æ¶ˆæ¯
	String message = "hello, message_";
	for (int i = 1; i <= 50; i++) {
		// å‘é€æ¶ˆæ¯
		rabbitTemplate.convertAndSend(queueName, message + i);
		Thread.sleep(20);
	}
}
```

## 3.consumer
*<u>æ¨¡æ‹Ÿä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ”¶</u>*
```java
@RabbitListener(queues = "simple.queue")
public void listenSimpleQueue1(String msg) throws InterruptedException {
	System.out.println("æ¶ˆè´¹è€…1æ¥æ”¶åˆ°æ¶ˆæ¯ -> " +msg);
	Thread.sleep(20);
}

@RabbitListener(queues = "simple.queue")
public void listenSimpleQueue2(String msg) throws InterruptedException {
	System.err.println("æ¶ˆè´¹è€…2æ¥æ”¶åˆ°æ¶ˆæ¯ -> " +msg);
	Thread.sleep(200);
}
```

</br>

# ä¸‰ã€FanoutExchange
<br/>

## 1.publisher
```java
/**  
 * fanoutExchange */@Test  
public void testFanoutExchange() {  
	// é˜Ÿåˆ—åç§°  
	String exchangeName = "itcast.fanout";  
	// æ¶ˆæ¯  
	String message = "hello, everyone!";  
	rabbitTemplate.convertAndSend(exchangeName, "", message);  
}
```

## 2.FanoutConfigç±»
```java
import org.springframework.amqp.core.Binding;  
import org.springframework.amqp.core.BindingBuilder;  
import org.springframework.amqp.core.FanoutExchange;  
import org.springframework.amqp.core.Queue;  
import org.springframework.context.annotation.Bean;  
import org.springframework.context.annotation.Configuration;  
  
/**  
 * @author SaddyFire  
 * @date 2021/12/18  
 * @TIME:14:47  
 */  
@Configuration  
public class FanoutConfig {  
 /**  
 * å£°æ˜äº¤æ¢æœº  
 * @return Fanoutç±»å‹äº¤æ¢æœº  
 */  
 @Bean  
 public FanoutExchange fanoutExchange(){  
	 return new FanoutExchange("itcast.fanout");  
 }  
  
 /**  
 * ç¬¬1ä¸ªé˜Ÿåˆ—  
 */  
 @Bean  
 public Queue fanoutQueue1(){  
	 return new Queue("fanout.queue1");  
 }  
  
 /**  
 * ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº  
 */  
 @Bean  
 public Binding bindingQueue1(Queue fanoutQueue1, FanoutExchange fanoutExchange){  
	 return BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);  
 }  
  
 /**  
 * ç¬¬2ä¸ªé˜Ÿåˆ—  
 */  
 @Bean  
 public Queue fanoutQueue2(){  
	 return new Queue("fanout.queue2");  
 }  
  
/**  
* ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº  
*/  
@Bean  
public Binding bindingQueue2(Queue fanoutQueue2, FanoutExchange fanoutExchange){  
		return BindingBuilder
		.bind(fanoutQueue2)
		.to(fanoutExchange);  
}  
  

```

## 3.consumer

```java
@RabbitListener(queues = "fanout.queue1")  
public void listenFanoutQueue1(String msg) {  
	 System.out.println("æ¶ˆè´¹è€…1æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€" + msg + "ã€‘");  
}  
  
@RabbitListener(queues = "fanout.queue2")  
public void listenFanoutQueue2(String msg) {  
	 System.out.println("æ¶ˆè´¹è€…2æ¥æ”¶åˆ°Fanoutæ¶ˆæ¯ï¼šã€" + msg + "ã€‘");  
}
```

</br>

# å››ã€directExchange
<br/>

## 1.publisher
```java
/**  
 * directExchange */@Test  
public void testDirectExchange() {  
	// äº¤æ¢æœºåç§°  
	String exchangeName = "itcast.direct";  
	// æ¶ˆæ¯  
	String message = "hello, red!";  
	String message2 = "hello, blue!";  
	String message3 = "hello, yellow!";  

	// å‘é€æ¶ˆæ¯  
	for (int i = 1; i <= 3; i++) {  
		rabbitTemplate.convertAndSend(exchangeName, "red", message);  
		rabbitTemplate.convertAndSend(exchangeName, "blue", message2);  
		rabbitTemplate.convertAndSend(exchangeName, "yellow", message3);  
	}  
}
```

## 2.consumer
*<u>æ³¨æ„æ³¨è§£</u>*
```java
/**  
 * directExchange * @param msg  
 */  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "direct.queue1"), //å®šä¹‰é˜Ÿåˆ—å  
 exchange = @Exchange(name = "itcast.direct"), //å®šä¹‰äº¤æ¢æœºåå­—/ç±»å‹(å¯çœç•¥)  
 key = {"blue","yellow"} //å®šä¹‰derict  
))  
public void listenDirectQueue1(String msg){  
	 System.out.println("direct.queue1æ”¶åˆ°æ¶ˆæ¯__" +msg);  
}  
  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "direct.queue2"), //å®šä¹‰é˜Ÿåˆ—å  
 exchange = @Exchange(name = "itcast.direct"), //å®šä¹‰äº¤æ¢æœºåå­—/ç±»å‹(å¯çœç•¥)  
 key = {"red","yellow"} //å®šä¹‰derict  
))  
public void listenDirectQueue2(String msg){  
	 System.err.println("direct.queue2æ”¶åˆ°æ¶ˆæ¯__" +msg);  
}
```

</br>

# äº”ã€topicExchange
<br/>

## 1.publisher

```java
/**  
 * topicExchange 
 */
@Test  
public void testTopicExchange() {  
	 // äº¤æ¢æœºåç§°  
	 String exchangeName = "itcast.topic";  
	 // æ¶ˆæ¯  
	 String message = "ä¸­å›½yyds!";  
	 String message2 = "å°æ—¥æœ¬ğŸ‘‡!";  
	 String message3 = "æ˜å¤©æ˜¯ä¸ªå¥½å¤©æ°”!";  

	 // å‘é€æ¶ˆæ¯  
	 for (int i = 1; i <= 3; i++) {  
		 rabbitTemplate.convertAndSend(exchangeName, "china.new", message);  
		 rabbitTemplate.convertAndSend(exchangeName, "japan.new", message2);  
		 rabbitTemplate.convertAndSend(exchangeName, "china.day", message3);  
	 }  
}
```

## 2.consumer
```java
/**  
 * topicExchange * @param msg  
 */  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "topic.queue1"), //å®šä¹‰é˜Ÿåˆ—å  
 exchange = @Exchange(name = "itcast.topic",type = ExchangeTypes.TOPIC), //å®šä¹‰äº¤æ¢æœºåå­—/ç±»å‹(å¯çœç•¥)  
 key = "china.#" //å®šä¹‰derict  
))  
public void listenTopicQueue1(String msg){  
 System.err.println("topic.queue1æ”¶åˆ°æ¶ˆæ¯__" +msg);  
}  
  
@RabbitListener(bindings = @QueueBinding(  
 value = @Queue(name = "topic.queue2"), //å®šä¹‰é˜Ÿåˆ—å  
 exchange = @Exchange(name = "itcast.topic",type = ExchangeTypes.TOPIC), //å®šä¹‰äº¤æ¢æœºåå­—/ç±»å‹(å¯çœç•¥)  
 key = "#.new" //å®šä¹‰derict  
))  
public void listenTopicQueue2(String msg){  
 System.err.println("topic.queue2æ”¶åˆ°æ¶ˆæ¯__" +msg);  
}
```

</br>

# å…­ã€å¯¹è±¡çš„ä¼ è¾“
<br/>

## publish
```java
/**  
 * fastJsonè½¬æ¢å¯¹è±¡  
 */  
/**  
 * workQueue * å‘é˜Ÿåˆ—ä¸­ä¸åœå‘é€æ¶ˆæ¯ï¼Œæ¨¡æ‹Ÿæ¶ˆæ¯å †ç§¯ã€‚  
 */  
@Test  
public void testWorkQueueJson(){  
	// é˜Ÿåˆ—åç§°  
	String queueName = "simple.queue.json";  
	// æ¶ˆæ¯  
	Map<String, Integer> map = new HashMap<>();  
	map.put("deedee",88);  
	String jsonMap = JSON.toJSONString(map);  
	rabbitTemplate.convertAndSend(queueName,jsonMap);  
}
```

## consumer
```java
@RabbitListener(queues = "simple.queue.json")  
public void queueJson(String msg){  
	 Map map = JSON.parseObject(msg, Map.class);  
	 System.out.println(map);  
}
```














